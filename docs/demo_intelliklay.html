<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="KMOTE Technologies">

<title>Análisis descriptivo de mensajes recibidos en la plataforma</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="inteliKlay_py_files/libs/clipboard/clipboard.min.js"></script>
<script src="inteliKlay_py_files/libs/quarto-html/quarto.js"></script>
<script src="inteliKlay_py_files/libs/quarto-html/popper.min.js"></script>
<script src="inteliKlay_py_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="inteliKlay_py_files/libs/quarto-html/anchor.min.js"></script>
<link href="inteliKlay_py_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="inteliKlay_py_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="inteliKlay_py_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="inteliKlay_py_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="inteliKlay_py_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Análisis descriptivo de mensajes recibidos en la plataforma</h1>
<p class="subtitle lead">Demostración</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Autor/a</div>
    <div class="quarto-title-meta-contents">
             <p>KMOTE Technologies </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Fecha de publicación</div>
    <div class="quarto-title-meta-contents">
      <p class="date">25 de marzo de 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="reporte-de-mensajes-por-tiempo" class="level1">
<h1>Reporte de mensajes por tiempo</h1>
<div id="27746c5e" class="cell" data-execution_count="5">
<div class="cell-output cell-output-display cell-output-markdown">
<p>En el periodo comprendido entre 2024-Jan-13 y 2024-Feb-24 hemos recibido un total de 178,329 mensajes, con 6,848 usuarios distintos. Calculando un promedio simple, recibimos alrededor de 26 mensajes por usuario.</p>
</div>
</div>
<p>En la <a href="#fig-msgs-per-usr" class="quarto-xref">Figura&nbsp;1</a> podemos ver una representación más acertada de cuantos mensajes se reciben por usuario.</p>
<div id="cell-fig-msgs-per-usr" class="cell" data-execution_count="6">
<div id="fig-msgs-per-usr" class="cell-output cell-output-display quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-msgs-per-usr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<iframe scrolling="no" width="100%" height="545px" src="iframe_figures/figure_69.html" frameborder="0" allowfullscreen=""></iframe>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-msgs-per-usr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;1: Histograma de la cantidad de mensajes mandados por usuario.
</figcaption>
</figure>
</div>
</div>
<p>Podemos ver cómo se distribuyeron los mensajes a lo largo del periodo con ayuda de la gráfica <a href="#fig-msgplot" class="quarto-xref">Figura&nbsp;2</a>.</p>
<div id="355f2491" class="cell" data-execution_count="7">
<div class="cell-output cell-output-display cell-output-markdown">
<p>Los datos están agrupados por semana. Se puede utilizar el selector de rango debajo de la figura para afinar el periodo de análisis</p>
</div>
</div>
<div id="cell-fig-msgplot" class="cell" data-execution_count="8">
<div id="fig-msgplot" class="cell-output cell-output-display quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-msgplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<iframe scrolling="no" width="100%" height="545px" src="iframe_figures/figure_71.html" frameborder="0" allowfullscreen=""></iframe>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-msgplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;2: Cantidad de mensajes por tiempo.
</figcaption>
</figure>
</div>
</div>
</section>
<section id="cuando-tenemos-el-primer-contacto" class="level1">
<h1>¿Cuando tenemos el primer contacto?</h1>
<p>En la figura <a href="#fig-msgplot-firstmsg" class="quarto-xref">Figura&nbsp;3</a> podemos ver una gráfica que indica la cantidad de “primeros contactos” por día. Consideramos que un “primer contacto” sucede cuando el chatbot comienza una conversación con un candidato del que no tiene previos registros.</p>
<div id="cell-fig-msgplot-firstmsg" class="cell" data-execution_count="9">
<div id="fig-msgplot-firstmsg" class="cell-output cell-output-display quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-msgplot-firstmsg-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<iframe scrolling="no" width="100%" height="545px" src="iframe_figures/figure_72.html" frameborder="0" allowfullscreen=""></iframe>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-msgplot-firstmsg-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3: Cantidad de chats nuevos por tiempo
</figcaption>
</figure>
</div>
</div>
<p>Una de las preguntas que podemos hacernos es, qué cantidad de nuestros mensajes del día a día son nuevos contactos, y cuantos son mensajes de seguimiento con candidatos previamente identificados. En la <a href="#fig-followups" class="quarto-xref">Figura&nbsp;4</a> vemos el número de mensajes de seguimiento contra el tiempo.</p>
<div id="cell-fig-followups" class="cell" data-execution_count="10">
<div id="fig-followups" class="cell-output cell-output-display quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-followups-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<iframe scrolling="no" width="100%" height="545px" src="iframe_figures/figure_73.html" frameborder="0" allowfullscreen=""></iframe>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-followups-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4: Número de mensajes de seguimiento en total enviados.
</figcaption>
</figure>
</div>
</div>
</section>
<section id="en-dónde-se-está-quedando-cada-conversaciónproceso" class="level1">
<h1>¿En dónde se está quedando cada conversación/proceso?</h1>
<p>En esta sección exploramos las secciones del proceso en los que concluye la conversación con el candidato. Algunas de estas secciones suponen procesos incompletos mientas que otras suponen procesos que concluyeron con éxito. La <a href="#fig-pie-final-actions" class="quarto-xref">Figura&nbsp;5</a> muestra una gráfica de pie en la que podemos ver que porcentaje de las conversaciones concluye en la sección del proceso marcada.</p>
<div id="cell-fig-pie-final-actions" class="cell" data-execution_count="11">
<div id="fig-pie-final-actions" class="cell-output cell-output-display quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-pie-final-actions-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<iframe scrolling="no" width="100%" height="545px" src="iframe_figures/figure_74.html" frameborder="0" allowfullscreen=""></iframe>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-pie-final-actions-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;5
</figcaption>
</figure>
</div>
</div>
<p>En la <a href="#fig-fractions-1stmsg" class="quarto-xref">Figura&nbsp;6</a> vemos una vez más el porcentaje de de conversaciones que conluye en la sección del proceso marcada, pero ahora excluimos aquellos candidatos que no contestaron al primer mensaje de bienvenida.</p>
<div id="cell-fig-fractions-1stmsg" class="cell" data-execution_count="12">
<div id="fig-fractions-1stmsg" class="cell-output cell-output-display quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-fractions-1stmsg-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<iframe scrolling="no" width="100%" height="545px" src="iframe_figures/figure_75.html" frameborder="0" allowfullscreen=""></iframe>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-fractions-1stmsg-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;6
</figcaption>
</figure>
</div>
</div>
<section id="análisis-de-procesos-completados" class="level2">
<h2 class="anchored" data-anchor-id="análisis-de-procesos-completados">Análisis de procesos completados</h2>
<p>En la <a href="#fig-success-rate" class="quarto-xref">Figura&nbsp;7</a> podemos ver una gráfica que representa que proporción de las conversaciones concluye exitosamente. Consideramos que una conversación termina con éxito cuando se logra agendar una entrevista, o el candidato es rechazado por alguno de los motivos designados al diseñar el chatbot.</p>
<div id="cell-fig-success-rate" class="cell" data-execution_count="13">
<div id="fig-success-rate" class="cell-output cell-output-display quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-success-rate-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<iframe scrolling="no" width="100%" height="545px" src="iframe_figures/figure_76.html" frameborder="0" allowfullscreen=""></iframe>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-success-rate-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;7
</figcaption>
</figure>
</div>
</div>
<p>La <a href="#fig-failure-reason" class="quarto-xref">Figura&nbsp;8</a> podemos ver la frecuencia de las partes del proceso en las cuales perdimos contacto con el candidato.</p>
<div id="cell-fig-failure-reason" class="cell" data-execution_count="14">
<div id="fig-failure-reason" class="cell-output cell-output-display quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-failure-reason-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<iframe scrolling="no" width="100%" height="545px" src="iframe_figures/figure_77.html" frameborder="0" allowfullscreen=""></iframe>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-failure-reason-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;8: Procentaje de última acción en procesos inconclusos
</figcaption>
</figure>
</div>
</div>
<p>Similarmente, en la <a href="#fig-success-reason" class="quarto-xref">Figura&nbsp;9</a> podemos ver los puntos de terminación exitosa más frecuentes. Recordemos que una terminación exitosa del proceso también puede significar un rechazo del candidato debido que que no cumplen algún requisito previamente estipulado para la vacante que se busca llenar.</p>
<p>Esta métrica es de vital importancia, ya que nos ayuda a entender cuantas potenciales entevistas fallidas pudimos evitar solamente filtrando a los candidatos en pasos anteriores.</p>
<div id="cell-fig-success-reason" class="cell" data-execution_count="15">
<div id="fig-success-reason" class="cell-output cell-output-display quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-success-reason-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<iframe scrolling="no" width="100%" height="545px" src="iframe_figures/figure_78.html" frameborder="0" allowfullscreen=""></iframe>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-success-reason-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;9: Acción de clausura más frecuente en chats que cerraron con éxito
</figcaption>
</figure>
</div>
</div>
<!---
¿Bajo qué condiciones terminan nuestros chats? 

::: {#1da053ea .cell execution_count=16}

::: {.cell-output .cell-output-display}

```{=html}
<iframe
    scrolling="no"
    width="100%"
    height="545px"
    src="iframe_figures/figure_79.html"
    frameborder="0"
    allowfullscreen
></iframe>
```

:::
:::


-->
</section>
</section>
<section id="horarios-en-los-que-la-gente-responde-más" class="level1">
<h1>Horarios en los que la gente responde más</h1>
<p>Para visualizar las horas de respuesta más comunes en el día contamos el total de mensajes recibidos en una hora específica. Esta cantidad determina la altura de una barra cuya posición horizontal corresponde a la hora del día, donde la barra de la extrema izquierda mide desde las 12 PM hasta la 1 AM, y la de extrema derecha mide desde 11 PM hasta 12 PM. Juntando estas barras y utilizando colores diferentes para diferenciar los días de la semana obtenemos la <a href="#fig-density-bars" class="quarto-xref">Figura&nbsp;10</a>. La sección superior muestra pequeñas barras. Cada una de estas corresponde a un solo mensaje.</p>
<div id="cell-fig-density-bars" class="cell" data-execution_count="17">
<div id="fig-density-bars" class="cell-output cell-output-display quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-density-bars-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<iframe scrolling="no" width="100%" height="545px" src="iframe_figures/figure_80.html" frameborder="0" allowfullscreen=""></iframe>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-density-bars-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;10: Gráfica de barras representando las horas más comunes de respuesta
</figcaption>
</figure>
</div>
</div>
<p>Utilizando el mismo principio podemos suavizar la figura y acomodarlas de manera horizontal. Esta forma de representación nos ayuda a ver cómo cambia la propensión a constestar de los candidatos a medida que avanza el día, y hace la separación de información más fácil.</p>
<div id="cell-fig-density-violin" class="cell" data-execution_count="18">
<div id="fig-density-violin" class="cell-output cell-output-display quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-density-violin-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<iframe scrolling="no" width="100%" height="545px" src="iframe_figures/figure_81.html" frameborder="0" allowfullscreen=""></iframe>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-density-violin-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;11: Gráfica de violín representando las horas más comunes de respuesta.
</figcaption>
</figure>
</div>
</div>
<section id="aproximadamente-cuanto-tiempo-tardan-los-usuarios-en-responder" class="level2">
<h2 class="anchored" data-anchor-id="aproximadamente-cuanto-tiempo-tardan-los-usuarios-en-responder">¿Aproximadamente, cuanto tiempo tardan los usuarios en responder?</h2>
<p>Medimos el tiempo promedio de respuesta, definido como el tiempo entre el último mensaje enviado por KlayBot, y el siguiente mensaje enviado por el usuario. La <a href="#fig-rtimes-dist" class="quarto-xref">Figura&nbsp;12</a> muestra la distribución de los tiempos de respuesta por minutos.</p>
<div id="cell-fig-rtimes-dist" class="cell" data-execution_count="19">
<div id="fig-rtimes-dist" class="cell-output cell-output-display quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-rtimes-dist-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<iframe scrolling="no" width="100%" height="545px" src="iframe_figures/figure_82.html" frameborder="0" allowfullscreen=""></iframe>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-rtimes-dist-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;12: Distribución de los tiempos de respuesta por chat
</figcaption>
</figure>
</div>
</div>
</section>
</section>
<section id="análisis-espacial" class="level1">
<h1>Análisis espacial</h1>
<p>Tomando a los candidatos cuyo proceso llegó al punto de solicitar su ciudad/estado podemos ver de qué áreas de México obtenemos tenemos más contactos. En la figura <a href="#fig-cp-choropleth" class="quarto-xref">Figura&nbsp;13</a> podemos ver los distintos códigos postales coloreados por el número de solicitantes de esa área. Cabe mencionar que algunos candidatos contados aqui no concluyeron con su proceso, y que aquellos que dieron un código postal fuera de la Ciudad de México no son contados.</p>
<div id="cell-fig-cp-choropleth" class="cell" data-execution_count="20">
<div id="fig-cp-choropleth" class="cell-output cell-output-display quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-cp-choropleth-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<iframe scrolling="no" width="100%" height="545px" src="iframe_figures/figure_83.html" frameborder="0" allowfullscreen=""></iframe>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-cp-choropleth-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;13: Mapa de la CDMX con códigos postales coloreados por número de solicitantes.
</figcaption>
</figure>
</div>
</div>
<!-- Tomando a los candidatos cuyo proceso llegó al punto de solicitar su código
postal podemos ver de qué áreas de la república obtenemos tenemos más contactos.
En la @fig-ciudades podemos ver una gráfica mostrando las proporciones de las
ciudades más representadas por candidatos.


#| label: fig-ciudades
#| fig-cap: Proporción de candidatos por ciudad

df = pd.read_csv("data/qry_ciudades.csv")

fig = go.Figure(
    data = [
        go.Pie(labels = list(df.body),
        values = list(df["count"]))
    ]
)

fig.update_traces(textposition='inside')
fig.update_layout(
    title_text="Ciudades de las cuales se reciben más solicitudes",
    uniformtext_minsize=12,
    uniformtext_mode='hide',
)

fig.show(config = config)
``` -->
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiado");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiado");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>